<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FCAB</title>
  <meta name="description" content="Luxury is a premium adman dashboard template based on bootstrap">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <!-- theme customizier \ demo only -->
  <link rel="stylesheet" href="login.html">
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/examples/js/theme-customizer.js"></script>

  <!-- core plugins -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/css/hamburgers.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/perfect-scrollbar/css/perfect-scrollbar.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/switchery/dist/switchery.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/sweetalert/dist/sweetalert.css">

  <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css">

  <!-- site-wide styles -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/css/bootstrap.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/css/site.css">

  <!-- plugins for the current page -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/datatables.net-dt/css/jquery.dataTables.min.css">


  <!-- current page styles -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/examples/css/demos/demos.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,600">

  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/breakpoints.js/dist/breakpoints.min.js"></script>
  <script>Breakpoints({ xs: { min: 0, max: 575 }, sm: { min: 576, max: 767 }, md: { min: 768, max: 991 }, lg: { min: 992, max: 1199 }, xl: { min: 1200, max: Infinity } });</script>

  <!-- Agregado Jorge -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
    crossorigin="anonymous">


</head>

<body class="menubar-left menubar-dark">
  <!--[if lt IE 10]>
      <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
  <nav class="site-navbar navbar fixed-top navbar-expand-md navbar-light bg-blue">
    <div class="navbar-header">
      <a class="navbar-brand" href="/">

        <!--d   
            <svg class="flip-y" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 32 32">
                <img src="http://www.jumbo.cl/FO_IMGS/htmls/modal-verano/img/logojumbocl.png" width="50" height="50">       </svg>
            -->
        <span class="brand-name hidden-fold">FCAB</span>
      </a>

      <a href="main.html" class="hidden-fold hidden-sm-down" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g transform="translate(.5 .5)" fill="none" stroke-linecap="square" stroke-miterlimit="10">
            <path stroke="currentColor" d="M23 12c0-1.105-.895-2-2-2h-1.262c-.19-.732-.477-1.422-.852-2.058l.892-.892c.78-.78.78-2.047 0-2.828-.78-.78-2.047-.78-2.828 0l-.892.892c-.636-.375-1.326-.663-2.058-.852V3c0-1.104-.895-2-2-2s-2 .895-2 2v1.262c-.732.19-1.422.477-2.058.852l-.892-.892c-.78-.78-2.047-.78-2.828 0-.78.78-.78 2.047 0 2.828l.892.892C4.74 8.578 4.45 9.268 4.262 10H3c-1.104 0-2 .895-2 2s.895 2 2 2h1.262c.19.732.477 1.422.852 2.058l-.892.892c-.78.78-.78 2.047 0 2.828.78.78 2.047.78 2.828 0l.892-.892c.635.375 1.326.663 2.058.852V21c0 1.104.895 2 2 2s2-.895 2-2v-1.262c.732-.19 1.422-.477 2.058-.852l.892.892c.78.78 2.047.78 2.828 0 .78-.78.78-2.047 0-2.828l-.892-.892c.375-.635.663-1.326.852-2.058H21c1.104 0 2-.895 2-2z" />
            <circle data-color="color-2" stroke="#52c03b" cx="12" cy="12" r="3" />
          </g>
        </svg>
      </a>

      <button data-toggle="menubar" class="mr-auto hidden-md-up hamburger hamburger--collapse js-hamburger" type="button">
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </button>

      <button type="button" class="navbar-toggler hidden-md-up collapsed" data-toggle="navbar-search">
        <span class="sr-only">Toggle navigation</span>
        <span class="zmdi zmdi-hc-lg zmdi-search"></span>
      </button>

      <button type="button" class="navbar-toggler hidden-md-up collapsed" data-toggle="collapse" data-target="#site-navbar-collapse"
        aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="zmdi zmdi-hc-lg zmdi-more"></span>
      </button>
    </div>
    <!-- /.navbar-header -->

    <div class="collapse navbar-collapse" id="site-navbar-collapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item hidden-sm-down">
          <a class="nav-link" href="#">
            <button data-toggle="menubar-fold" class="hamburger hamburger--arrowalt is-active js-hamburger" type="button">
              <span class="hamburger-box">
                <span class="hamburger-inner"></span>
              </span>
            </button>
          </a>
        </li>







      </ul>

      <ul class="navbar-nav">




        <li class="nav-item dropdown">
          <a class="nav-link site-user dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <img class="nav-img" src="https://cdn.rawgit.com/Choopers/monitor/master/Template/global/images/user-img.png"
              alt="">
            <span class="nav-text hidden-sm-down ml-2">
              <%=nombre_usuario%>
            </span>
            <i class="nav-caret hidden-sm-down zmdi zmdi-hc-sm zmdi-chevron-down"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right p-0" data-plugin="dropdownCaret">
            <a class="dropdown-item dropdown-menu-cap">
              <%=nombre_usuario%>
            </a>


            <a class="dropdown-item" href="/salir">
              <i class="fa fa-power-off mr-3"></i>
              <span>Desconectar</span>
            </a>
          </div>
        </li>


      </ul>
      <!-- /.navbar-nav -->
    </div>
    <!-- /.navbar-collapse -->
  </nav>
  <!-- /.site-navbar -->



  <div class="site-wrapper">
    <aside class="site-menubar">
      <div class="site-menubar-inner">
        <ul class="site-menu">

          <!-- Menu de Navegacion JLM -->
          <li class="menu-section-heading">MAIN NAVIGATION </li>


          <li>
            <a href="/">
              <i class="menu-icon zmdi zmdi-account"></i>
              <span class="menu-text">Usuarios</span>
            </a>
          </li>
          <li class="menu-section-heading">DATA</li>
          <li>
            <a href="javascript:void(0)" class="submenu-toggle">
              <i class="menu-icon zmdi zmdi-globe-alt"></i>
              <span class="menu-text">Mantenedores</span>
              <i class="menu-caret zmdi zmdi-hc-sm zmdi-chevron-right"></i>
            </a>
            <ul class="submenu">
              <li><a href="/itinerarios"><span class="menu-text">Itinerarios</span></a></li>
              <li><a href="/tiempodistancia"><span class="menu-text">Tiempo y Distancia</span></a></li>
              <li><a href="/zonas"><span class="menu-text">Zonas</span></a></li>
              <li><a href="/parametros"><span class="menu-text">Parametros</span></a></li>

            </ul>
          </li>







        </ul>
        <!-- /.site-menu -->
      </div>
      <!-- /.site-menubar-inner -->
    </aside>
    <!-- /.site-menubar -->
    <main class="site-main">
      <header class="site-header">


        <div class="breadcrumb">
          <ol class="breadcrumb-tree">
            <li class="breadcrumb-item">
              <a href="#">
                <span class="zmdi zmdi-home mr-1"></span>
                <span>Home</span>
              </a>
            </li>
            <li class="breadcrumb-item active"><a href="#">Listar Casos</a></li>
          </ol>


        </div><!-- /.breadcrumb -->
      </header><!-- /.site-header -->

      <div class="site-content">
        <h2>Administracion de Usuarios</h2>




        <button type="button" class="btn btn-success" onclick="agregar()">Agregar Usuarios</button>


        <table id="table" class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Nombre</th>
              <th>Clave</th>
              <th>Tipo</th>
              <th>Acción</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        <!-- Modal -->
        <div class="modal fade" id="modal_usuarios" role="dialog">
          <div class="modal-dialog">
            <div class="modal-content">
              <!-- Modal Header -->
              <div class="modal-header">

                <h4 class="modal-title" id="myModalLabel">Contact Form</h4>
                <button type="button" class="close" data-dismiss="modal">
                  <span aria-hidden="true">×</span>
                  <span class="sr-only">Close</span>
                </button>
              </div>
              <!-- Modal Body -->
              <div class="modal-body">
                <p class="statusMsg"></p>
                <form role="form" id="form">

                  <div class="form-group">
                    <input type="hidden" value="" name="id" /> <!-- Dato Oculto para manejar Id -->
                    <label for="inputName">Nombre</label>
                    <input type="text" class="form-control" id="inputName" name="nombre" placeholder="Ingresar Nombre" />
                  </div>
                  <div class="form-group">
                    <label for="inputEmail">Usuario</label>
                    <input type="email" class="form-control" id="inputEmail" name="usuario" placeholder="Ingresar Usuario" />
                  </div>
                  <div class="form-group">
                    <label for="inputEmail">Clave</label>
                    <input type="email" class="form-control" id="inputEmail" name="clave" placeholder="Ingresar Clave" />
                  </div>
                  <div class="form-group">
                    <label for="inputEmail">Tipo</label>

                    <select class="form-control" name="tipo" id="ftpedido">

                      <option value="0">Seleccionar Tipo Usuario</option>
                      <option value="1">Super User</option>
                      <option value="2">Master Data</option>
                      <option value="3">Run Cases</option>

                    </select>
                  </div>

                </form>
              </div>

              <!-- Modal Footer -->
              <div class="modal-footer">
                <button type="button" id="btnSave" onclick="Guardar()" class="btn btn-primary">Guardar</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
              </div>
            </div>
          </div>
        </div>




      </div><!-- /.site-content -->





      <footer class="site-footer">

      </footer><!-- /.site-footer -->
    </main><!-- /.site-main -->
  </div><!-- /.site-warpper -->



  <!-- core plugins -->
  <!-- Añadido Jorge -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.js"></script>
  <!-- Fin-->


  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/popper.js/dist/umd/popper.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/switchery/dist/switchery.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/waypoints/lib/jquery.waypoints.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/waypoints/lib/shortcuts/sticky.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/counterup/jquery.counterup.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/js/jquery.sparkline.min.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/global/js/plugins/dropdown-caret.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/global/js/plugins/firstlitter.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/global/js/plugins/video-modal.js"></script>

  <!-- plugins for the current page -->
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/vendor/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>


  <!-- site-wide scripts -->
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/global/js/main.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/js/site.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/js/navbar.js"></script>
  <script src="https://cdn.rawgit.com/Choopers/monitor/master/js/menubar.js"></script>
  <script src="https://cdn.datatables.net/select/1.2.7/js/dataTables.select.min.js"></script>

  <!-- current page scripts -->

  <script src="https://cdn.rawgit.com/Choopers/monitor/master/Template/examples/js/demos/tables.datatables.js"></script>

</body>

</html>

<!-- Script de Funcionalidades -->

<script>

  var table;
  var save_method;
  var url;
  $(document).ready(function () {

    //  cargar_sucursales(); // Carga de Sucursales
    //  cargar_estado(); // Filtro Estado
    $(window).scroll(function () {
      return false;
    });


    table = $('#table').DataTable({
      "processing": true,
      "serverSide": true,
      "searching": false,
      "ajax": {
        "url": "/listar_usuarios",
        "type": "POST"
      },
      dom: 'Bfrtip',
      buttons: [{
        extend: 'pdf',
        text: 'PDF'
      }, {
        extend: 'excel',
        text: 'EXCEL'
      }, {
        extend: 'csv',
        text: 'CSV'
      }, {
        extend: 'print',
        text: 'Imprimir'
      }],
      scrollX: false,
      scrollY: false,

      //  "sScrollY": "200px",
      "columnDefs": [{
        "targets": [-1], //last column
        "orderable": false, //set not orderable
      },],
      "language": {
        "sProcessing": "Procesando...",
        "sLengthMenu": "Mostrar _MENU_ ",
        "sZeroRecords": "No se encontraron resultados",
        "sEmptyTable": "No se encuentran Ordenes Tacking",
        "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
        "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
        "sInfoPostFix": "",
        "sSearch": "Buscar por Orden:  ",
        "sUrl": "",
        "sInfoThousands": ",",
        "sLoadingRecords": "Cargando...",
        "oPaginate": {
          "sFirst": "Primero",
          "sLast": "Último",
          "sNext": "Siguiente",
          "sPrevious": "Anterior"
        },
        "oAria": {
          "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
          "sSortDescending": ": Activar para ordenar la columna de manera descendente"
        }
      }

    });
    //set input/textarea/select event when change value, remove class error and remove text help block
    $("input").change(function () {
      $(this).parent().parent().removeClass('has-error');
      $(this).next().empty();
    });
    $("textarea").change(function () {
      $(this).parent().parent().removeClass('has-error');
      $(this).next().empty();
    });
    $("select").change(function () {
      $(this).parent().parent().removeClass('has-error');
      $(this).next().empty();
    });

  });


  function agregar() {
    save_method = 'add';
    $('#form')[0].reset();
    $('.form-group').removeClass('has-error');
    $('.help-block').empty();
    $('#modal_usuarios').modal('show');
    $('.modal-title').text('Añadir Usuarios');

  }

  function reload_table() {
    table.ajax.reload(null, false);
  }

  function Guardar() {
    $('#btnSave').text('Guardando...');
    $('#btnSave').attr('disabled', true);


    if (save_method == 'add') {
      url = "/insertar_usuarios";
    } else {
      url = "/actualizar_usuarios";
    }


    $.ajax({
      url: url,
      type: "POST",
      data: $('#form').serialize(),
      dataType: "JSON",
      success: function (data) {

        if (data.status) {
          $('#modal_usuarios').modal('hide');
          reload_table();
        } else {
          for (var i = 0; i < data.inputerror.length; i++) {
            $('[name="' + data.inputerror[i] + '"]').parent().parent().addClass('has-error'); //select parent twice to select div form-group class and add has-error class
            $('[name="' + data.inputerror[i] + '"]').next().text(data.error_string[i]); //select span help-block class set text error string
          }
        }
        $('#btnSave').text('Guardar');
        $('#btnSave').attr('disabled', false);


      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert('Correo, se encuentra en uso');
        $('#btnSave').text('Guardar');
        $('#btnSave').attr('disabled', false);

      }
    });
  }

  function editar(id) {
    save_method = 'update';
    $('#form')[0].reset();
    $('.form-group').removeClass('has-error');
    $('.help-block').empty();
    let idOrderVtex = id.toString();
    idOrderVtex = idOrderVtex.replace('/', '');
    idOrderVtex = idOrderVtex.replace('/', '');

    $.ajax({
      url: "/obtener_por_id_usuarios",
      type: "POST",
      data: { "id": idOrderVtex },
      dataType: "JSON",
      success: function (data) {

        $('[name="id"]').val(idOrderVtex);
        $('[name="nombre"]').val(data.nombre);
        $('[name="usuario"]').val(data.usuario);
        $('[name="clave"]').val(data.clave);
        $('[name="tipo"]').val(data.tipo);

        $('#modal_usuarios').modal('show'); // show bootstrap modal when complete loaded
        $('.modal-title').text('Editar Usuarios'); // Set title to Bootstrap modal title

      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert('Error get data from ajax');
      }
    });
  }

  function eliminar(id) {
    let idOrderVtex = id.toString();
    idOrderVtex = idOrderVtex.replace('/', '');
    idOrderVtex = idOrderVtex.replace('/', '');
    if (confirm('Se Encuentra seguro de Eliminar los Datos?')) {

      $.ajax({
        url: "/eliminar_usuarios/" + idOrderVtex,
        type: "POST",
        dataType: "JSON",
        success: function (data) {
          //if success reload ajax table
          $('#modal_form').modal('hide');
          reload_table();
        },
        error: function (jqXHR, textStatus, errorThrown) {
          alert('Error al eliminar datos');
        }
      });

    }
  }

</script>



<style>
  table.dataTable {
    border: none;
  }
</style>